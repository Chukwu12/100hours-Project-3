<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= user.userName %>'s Profile
  </title>
  <!-- Font-awesome -->
  <script src="https://kit.fontawesome.com/bb1892d46f.js" crossorigin="anonymous"></script>
  <!-- Glide.js CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.theme.min.css">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
  <header id="main-nav">
    <div class="container-fluid">
      <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/" aria-label="Homepage">
          <img src="/image/onice-logo.png" alt="Onice Logo" height="30">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse " id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/recipe">Recipes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/profile">Profile</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </header>





  <!-- Background Wrapper -->
  <div class="background-wrapper">

    <!-- Profile Card -->
    <section id="user-card">
      <div class="shadow overflow">
        <div id="header"></div>
        <div id="profile">
          <div class="profile-image">
            <!-- Display the user's profile image or the default image -->
            <img src="<%= user.profileImage || '/image/user-profilepic.png' %>" alt="<%= user.userName %>'s profile"
              id="profile-image-display">
            <!-- File input for uploading the image -->
            <input type="file" id="profile-image-upload" accept="image/*" style="display:none;" autocomplete="on"
              onchange="previewImage(event)" />
          </div>

          <div class="user-info">
            <i class="fa-solid fa-user">
              <p><strong>User Name</strong>: <%= user.userName %>
              </p>
            </i>
            <i class="fa-solid fa-envelope">
              <p><strong>Email</strong>: <%= user.email %>
              </p>
            </i>
            <!-- Badge Example -->
            <div class="badge">
              <span class="badge-text">Verified</span>
            </div>
            <div class="bottom">
            </div>
          </div>

          <!-- Label to trigger the file input -->
          <label for="profile-image-upload" class="profile-label mt-2"><span>Add Photo</span></label>
        </div>
      </div>
    </section>





    <!-- Favorite Recipes Section -->
    <!-- Favorite Recipes Section -->
    <section id="user-card2">
      <div class="row">
        <div class="col-xl">
          <h2>Favorite Recipes</h2>

          <div class="glide favorite-glide">
            <div class="glide__track" data-glide-el="track">
              <ul class="glide__slides">
                <% if (validFavorites.length> 0) { %>
                  <% validFavorites.forEach(fav=> { %>
                    <li class="glide__slide">
                      <div class="favorite-recipe-card">
                        <figure>
                          <img src="<%= fav.recipe.image %>" alt="<%= fav.recipe.title %>">
                        </figure>
                        <div class="favorite-recipe-content">
                          <h4>
                            <%= fav.recipe.title %>
                          </h4>
                          <p><strong>Servings:</strong>
                            <%= fav.recipe.servings %>
                          </p>
                          <p><strong>Ready in:</strong>
                            <%= fav.recipe.readyInMinutes %> mins
                          </p>
                          <button class="remove-fav-btn animate__animated animate__pulse"
                            data-id="<%= fav.spoonacularId %>">
                             <i class="fa-solid fa-trash"></i>
                          </button>


                        </div>
                      </div>
                    </li>
                    <% }) %>
                      <% } else { %>
                        <li>No favorite recipes yet.</li>
                        <% } %>
              </ul>
            </div>
          </div>

        </div>
      </div>
    </section>



    <!-- Profile Triva section -->
    <section id="user-card3">
      <div class="row">
        <div class="col">
          <!-- Food Trivia -->
          <div class="fun-facts">
            <h2>Welcome to the Food Trivia Facts</h2>
            <p class="trivia-question">Click the button to get a trivia fact!</p>
            <button id="next-trivia">Next Trivia</button>
          </div>
        </div>
      </div>
    </section>


    <!-- Profile Create Recipe Section -->
    <section id="user-card4">
      <div class="row">
        <div class="col">
          <!-- Create Recipes  -->
          <div class="create-container">
            <div class="create-content">
              <h1>"Create Your Perfect Recipe"..</h1>
              <!-- Cooking animation: Initially hidden -->
              <div id="cookingAnimation">
                <div id="cooking">
                  <div class="bubble"></div>
                  <div class="bubble"></div>
                  <div class="bubble"></div>
                  <div class="bubble"></div>
                  <div class="bubble"></div>
                  <div id="area">
                    <div id="sides">
                      <div id="pan"></div>
                      <div id="handle"></div>
                    </div>
                    <div id="pancake">
                      <div id="pastry"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recipe Form -->
              <form action="/recipe/createRecipe" enctype="multipart/form-data" method="POST" autocomplete="on"
                onsubmit="showCookingAnimation()">
                <div class="mb-3">
                  <label for="name" class="form-label">Recipe Name</label>
                  <input type="text" class="form-control" id="name" name="name" placeholder="e.g., Recipe Name" required
                    autocomplete="recipe-name">
                </div>
                <div class="mb-3">
                  <label for="ingredients" class="form-label">Ingredients</label>
                  <div id="ingredientsList">
                    <input type="text" class="form-control" name="ingredients[]" placeholder="e.g., Ingredient" required
                      autocomplete="ingredients">
                  </div>
                  <button type="button" class="btn btn-secondary mt-2" onclick="addIngredient()">Add Another
                    Ingredient</button>
                </div>
                <div class="mb-3">
                  <label for="directions" class="form-label">Cooking Directions</label>
                  <textarea class="form-control" id="directions" name="directions" placeholder="Cooking Directions..."
                    required autocomplete="directions"></textarea>
                </div>
                <div class="mb-3">
                  <label for="imageUpload" class="form-label">Upload Recipe Image</label>
                  <input type="file" class="form-control" id="imageUpload" name="file" accept="image/*" required
                    autocomplete="off">
                  <small class="form-text text-muted">Upload a clear image of your recipe.</small>
                </div>
                <div class="mb-3">
                  <label for="spoonacularId" class="form-label">Spoonacular ID</label>
                  <input type="text" class="form-control" id="spoonacularId" name="spoonacularId"
                    placeholder="e.g., 12345" required autocomplete="spoonacular-id">
                  <small class="form-text text-muted">Find this ID on the Spoonacular website for reference.</small>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>
            </div>
          </div>


        </div>
      </div>
    </section>




  </div>
  <!-- Background Wrapper End -->





  <!-- Profile Card  End-->


  <!-- Initialize Glide -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const favoriteSlides = document.querySelectorAll('.favorite-glide .glide__slide');
      if (favoriteSlides.length > 0) {
        new Glide('.favorite-glide', {
          type: 'carousel',
          startAt: 0,
          perView: 2,
          autoplay: 3000,
          hoverpause: true,
          breakpoints: {
            992: {
              perView: 1 // For tablets and small laptops
            },
            768: {
              perView: 1 // For mobile and small tablets
            }
          }
        }).mount();
      }
    });
  </script>

  <script>
  document.querySelectorAll('.remove-fav-btn').forEach(button => {
    button.addEventListener('click', async () => {
      const id = button.dataset.id;

      const confirmed = await Swal.fire({
        title: 'Are you sure?',
        text: 'Remove this recipe from favorites?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, remove it!',
        cancelButtonText: 'Cancel',
      });

      if (confirmed.isConfirmed) {
        try {
          const response = await fetch(`/profile/recipe/favoriteRecipe/${id}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
          });

          if (response.ok) {
            Swal.fire('Removed!', 'Recipe has been removed from your favorites.', 'success')
              .then(() => window.location.reload());
          } else {
            throw new Error('Delete failed');
          }
        } catch (error) {
          Swal.fire('Error', 'Failed to remove the recipe.', 'error');
        }
      }
    });
  });
</script>



  <!-- Glide.js -->
  <script src="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/glide.min.js"></script>

  <!-- Include Axios from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- sweetalerts -->
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <!-- Custom JS -->
  <script type="module" src="js/profile.js"></script>
</body>

</html>